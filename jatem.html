<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jatuh Tempo ‚Äî CV Mestika Lestari</title>

<style>
body {
  margin: 0;
  font-family: "Segoe UI", Arial, sans-serif;
  background: #f4f6f8;
}

/* HEADER */
header {
  background: #1b5e20;
  color: white;
  padding: 22px;
  text-align: center;
  font-size: 24px;
  font-weight: bold;
}

/* LAYOUT */
.container {
  width: 95%;
  max-width: 1200px;
  margin: 25px auto;
}

.card {
  background: white;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  margin-bottom: 20px;
}

h2 {
  margin-top: 0;
  color: #1b5e20;
}

/* FORM */
.form-grid {
  display: grid;
  gap: 12px;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
}

input {
  padding: 10px;
  border-radius: 6px;
  border: 1px solid #ccc;
}

button {
  margin-top: 12px;
  padding: 12px;
  border: none;
  border-radius: 8px;
  background: #1b5e20;
  color: white;
  font-size: 15px;
  cursor: pointer;
}

button:hover {
  background: #145a1f;
}

/* PRINT BUTTON */
.print-btn {
  margin-bottom: 15px;
}

/* TABLE */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
  font-size: 14px;
}

th, td {
  border: 1px solid #ccc;
  padding: 10px;
}

th {
  background: #c8e6c9;
}

tr:nth-child(even) {
  background: #f1f8e9;
}

/* STATUS */
.status {
  padding: 5px 12px;
  border-radius: 20px;
  font-weight: bold;
  font-size: 12px;
  color: white;
  text-align: center;
}

.lunas { background: #16a34a; }
.terlambat { background: #dc2626; }
.warning { background: #facc15; color: #000; }
.aktif { background: #2563eb; }

.footer {
  text-align: center;
  font-size: 13px;
  color: #777;
  margin: 25px 0;
}

/* ================= PRINT MODE ================= */
@media print {

  body {
    background: white;
  }

  header,
  .footer,
  .no-print {
    display: none !important;
  }

  .card {
    box-shadow: none;
    border: none;
  }

  table {
    font-size: 12px;
  }
}
</style>
</head>

<body>

<header>JATUH TEMPO ‚Äî CV MESTIKA LESTARI</header>

<div class="container">

  <!-- BUTTON PRINT -->
  <button onclick="window.print()" class="print-btn no-print">
    üñ®Ô∏è Print Disini
  </button>

  <!-- FORM INPUT (TIDAK IKUT PRINT) -->
  <div class="card no-print">
    <h2>Input Jatuh Tempo</h2>
    <div class="form-grid">
      <input id="nomor_invoice" placeholder="Nomor Invoice">
      <input id="nomor_faktur" placeholder="Nomor Faktur">
      <input id="tanggal_terima" type="date">
      <input id="nama_customer" placeholder="Nama Customer">
      <input id="total_tagihan" type="number" placeholder="Total Tagihan">
      <input id="jatuh_tempo" type="date">
      <input id="keterangan" placeholder="Keterangan (Lunas / Cash)">
    </div>
    <button onclick="simpan()">üíæ Simpan Data</button>
    <div id="info"></div>
  </div>

  <!-- TABEL (INI YANG DI PRINT) -->
  <div class="card">
    <h2>Data Jatuh Tempo</h2>
    <table>
      <thead id="thead"></thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>

</div>

<div class="footer">¬© CV Mestika Lestari</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzs6QQMeRvDu5-vZXsPnXdgODY-IKdGmYhCYP8VVc22cd-YHO2ktfznT2G3CQLxOiAG/exec";

/* STATUS */
function getStatus(jt, ket) {
  if (ket && ket.toLowerCase().includes("lunas"))
    return {text:"LUNAS", cls:"lunas"};

  const today = new Date(); today.setHours(0,0,0,0);
  const d = new Date(jt); d.setHours(0,0,0,0);
  const diff = Math.ceil((d - today)/(1000*60*60*24));

  if (diff < 0) return {text:"TERLAMBAT", cls:"terlambat"};
  if (diff <= 3) return {text:"JATUH TEMPO", cls:"warning"};
  return {text:"AKTIF", cls:"aktif"};
}

/* LOAD DATA */
async function loadData() {
  const res = await fetch(API_URL);
  const data = await res.json();
  if (!data.length) return;

  const headers = Object.keys(data[0]);
  thead.innerHTML =
    "<tr>" + headers.map(h=>`<th>${h}</th>`).join("") + "<th>STATUS</th></tr>";

  let rows = "";
  data.forEach(r => {
    const st = getStatus(r["JATUH TEMPO"], r["KETERANGAN"]);
    rows += "<tr>";
    headers.forEach(h => rows += `<td>${r[h] ?? ""}</td>`);
    rows += `<td><span class="status ${st.cls}">${st.text}</span></td></tr>`;
  });
  tbody.innerHTML = rows;
}

/* SIMPAN */
async function simpan() {
  info.innerText = "Menyimpan...";
  const payload = {
    "NOMOR INVOICE": nomor_invoice.value,
    "NOMOR FAKTUR": nomor_faktur.value,
    "TANGGAL TERIMA": tanggal_terima.value,
    "NAMA CUSTOMER": nama_customer.value,
    "TOTAL TAGIHAN": total_tagihan.value,
    "JATUH TEMPO": jatuh_tempo.value,
    "KETERANGAN": keterangan.value
  };

  const res = await fetch(API_URL,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(payload)
  });

  const r = await res.json();
  if (r.status === "success") {
    info.innerText = "‚úÖ Data tersimpan";
    document.querySelectorAll("input").forEach(i=>i.value="");
    loadData();
  } else {
    info.innerText = "‚ùå Gagal simpan";
  }
}

loadData();
</script>

</body>
</html>
