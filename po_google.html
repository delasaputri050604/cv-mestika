<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Purchase Order - CV Mestika Lestari</title>

<!-- PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
*{
  box-sizing:border-box;
  font-family:Arial, sans-serif;
}

body{
  margin:0;
  background:#f4f6f8;
}

/* HEADER */
header{
  background:#2e7d32;
  color:#fff;
  padding:18px;
  text-align:center;
  font-size:22px;
  font-weight:bold;
}

/* CONTAINER */
.container{
  width:95%;
  margin:20px auto;
}

/* SEARCH */
.search-box{
  background:#fff;
  padding:12px;
  border-radius:8px;
  margin-bottom:12px;
}

.search-box input{
  width:100%;
  padding:10px;
}

/* ACTION */
.action{
  display:flex;
  justify-content:flex-end;
  gap:8px;
  margin-bottom:10px;
}

button{
  padding:8px 16px;
  border:none;
  border-radius:5px;
  background:#2e7d32;
  color:#fff;
  cursor:pointer;
}

/* TABLE */
table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  font-size:14px;
}

th,td{
  border:1px solid #ccc;
  padding:8px;
}

th{
  background:#c8e6c9;
  text-align:center;
}

/* ROW MARKER */
tbody tr:nth-child(odd){
  background:#fafafa;
}

tbody tr:hover{
  background:#e8f5e9;
  border-left:5px solid #2e7d32;
}

/* PRINT */
@media print{
  @page{
    size:A4 landscape;
    margin:15mm;
  }

  header,
  .search-box,
  .action{
    display:none;
  }

  table{
    font-size:11px;
  }

  th,td{
    border:1px solid #000;
  }

  .print-title{
    display:block;
    text-align:center;
    margin-bottom:10px;
  }
}

/* PRINT TITLE */
.print-title{
  display:none;
}
</style>
</head>

<body>

<header>CV MESTIKA LESTARI â€” PURCHASE ORDER</header>

<div class="container">

  <div class="search-box">
    <input id="searchInput" placeholder="Cari data..." onkeyup="filterData()">
  </div>

  <div class="action">
    <button onclick="window.print()">ðŸ–¨ Print</button>
    <button onclick="exportPDF()">ðŸ“„ PDF</button>
  </div>

  <div class="print-title">
    <h2>PURCHASE ORDER</h2>
    <div>CV Mestika Lestari</div>
    <div id="printDate"></div>
  </div>

  <table>
    <thead id="thead"></thead>
    <tbody id="tbody"></tbody>
  </table>

</div>

<script>
const API_URL =
"https://script.google.com/macros/s/AKfycbwyt_FjGdWvrZJLldoKY0rEg-BToGCUk8XkhO73YSke-FLMy5D7PJ7Fxug1beX78kgU5g/exec";

let dataPO=[];

/* helper */
function parseAngka(v){
  if(!v) return "";
  const n=v.toString().replace(/[^0-9]/g,"");
  return n?Number(n):"";
}

function rupiah(n){
  if(n==="" || n===null) return "";
  return "Rp " + n.toLocaleString("id-ID");
}

function formatTanggal(v){
  if(!v) return "";
  const d=new Date(v);
  if(isNaN(d)) return v;
  return d.toLocaleDateString("id-ID");
}

/* load */
async function loadData(){
  const res=await fetch(API_URL);
  dataPO=await res.json();
  render(dataPO);
}

/* render */
function render(data){
  if(!data.length){
    tbody.innerHTML="<tr><td>Belum ada data</td></tr>";
    return;
  }

  thead.innerHTML="<tr>"+Object.keys(data[0]).map(h=>`<th>${h}</th>`).join("")+"</tr>";

  let html="";
  data.forEach(r=>{
    html+="<tr>";
    Object.entries(r).forEach(([k,v])=>{
      if(k==="HARGA" || k==="PPN"){
        html+=`<td align="right">${rupiah(parseAngka(v))}</td>`;
      }
      else if(k.includes("TANGGAL")){
        html+=`<td>${formatTanggal(v)}</td>`;
      }
      else{
        html+=`<td>${v??""}</td>`;
      }
    });
    html+="</tr>";
  });

  tbody.innerHTML=html;
}

/* search */
function filterData(){
  const k=searchInput.value.toLowerCase();
  render(
    dataPO.filter(r=>
      Object.values(r).join(" ").toLowerCase().includes(k)
    )
  );
}

/* PDF */
async function exportPDF(){
  const {jsPDF}=window.jspdf;
  const canvas=await html2canvas(document.body);
  const img=canvas.toDataURL("image/png");
  const pdf=new jsPDF("landscape","mm","a4");
  const w=pdf.internal.pageSize.getWidth();
  const h=canvas.height*w/canvas.width;
  pdf.addImage(img,"PNG",0,10,w,h);
  pdf.save("PO_CV_Mestika_Lestari.pdf");
}

/* date */
document.getElementById("printDate").innerText =
  "Tanggal Cetak: " + new Date().toLocaleDateString("id-ID");

loadData();
</script>

</body>
</html>
