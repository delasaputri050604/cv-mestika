<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">

<!-- VIEWPORT DIKUNCI -->
<meta name="viewport" content="width=1200">

<title>Master Barang â€” CV Mestika Lestari</title>

<!-- PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
*{
  box-sizing:border-box;
  font-family:Segoe UI,Arial,sans-serif;
}

body{
  margin:0;
  background:#f4f6f8;
}

/* ===== HEADER ===== */
header{
  background:#1b5e20;
  color:#fff;
  padding:20px;
  text-align:center;
  font-size:22px;
  font-weight:bold;
}

/* ===== CONTAINER FIXED ===== */
.container{
  width:1200px;
  margin:20px auto;
}

/* ===== CARD ===== */
.card{
  background:#fff;
  padding:20px;
  border-radius:12px;
  box-shadow:0 6px 15px rgba(0,0,0,.1);
}

/* ===== TOP BAR ===== */
.top-bar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}

.search-box input{
  width:350px;
  padding:10px;
  border-radius:8px;
  border:1px solid #ccc;
}

button{
  padding:10px 16px;
  border:none;
  border-radius:6px;
  background:#2e7d32;
  color:#fff;
  cursor:pointer;
}

/* ===== TABLE ===== */
.table-wrap{
  overflow:hidden;
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:14px;
}

th,td{
  border:1px solid #ccc;
  padding:8px 10px;
  white-space:nowrap;
}

th{
  background:#c8e6c9;
  text-align:center;
}

/* ZEBRA */
tbody tr:nth-child(even){
  background:#f1f8e9;
}
tbody tr:hover{
  background:#e0f2f1;
}

/* ===== FOOTER ===== */
.footer{
  text-align:center;
  margin-top:20px;
  font-size:13px;
  color:#777;
}

/* ===== PRINT LANDSCAPE ===== */
@media print{
  @page{
    size:A4 landscape;
    margin:12mm;
  }
  header,.top-bar,.footer{display:none}
  body{background:#fff}
  .card{box-shadow:none;padding:0}
  table{font-size:11px}
  th,td{border:1px solid #000}
  tr{page-break-inside:avoid}
}
</style>
</head>

<body>

<header>MASTER BARANG â€” CV MESTIKA LESTARI</header>

<div class="container">

  <div class="card">

    <div class="top-bar">
      <div class="search-box">
        <input id="search" placeholder="Cari kode, nama barang, bahan aktif...">
      </div>
      <div>
        <button onclick="window.print()">ðŸ–¨ Print</button>
        <button onclick="exportPDF()">ðŸ“„ PDF</button>
      </div>
    </div>

    <div class="table-wrap">
      <table>
        <thead id="thead"></thead>
        <tbody id="tbody">
          <tr><td align="center">Loading...</td></tr>
        </tbody>
      </table>
    </div>

  </div>

  <div class="footer">Â© CV Mestika Lestari</div>
</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbw6gQrMF8D0v8kEBhMFN1F6X9kIu-MSI7D5zQb1zr2RZQwZReJqmUMxR_OPctPyTwYN/exec";
let allData=[];

/* LOAD DATA */
async function loadMaster(){
  const res=await fetch(API_URL);
  allData=await res.json();
  render(allData);
}

/* RENDER TABLE */
function render(data){
  if(!data.length){
    tbody.innerHTML="<tr><td align='center'>Belum ada data</td></tr>";
    return;
  }
  const headers=Object.keys(data[0]);
  thead.innerHTML="<tr>"+headers.map(h=>`<th>${h}</th>`).join("")+"</tr>";

  tbody.innerHTML=data.map(r=>{
    return "<tr>"+headers.map(h=>`<td>${r[h]??""}</td>`).join("")+"</tr>";
  }).join("");
}

/* SEARCH */
document.getElementById("search").addEventListener("input",e=>{
  const k=e.target.value.toLowerCase();
  render(allData.filter(r=>
    Object.values(r).join(" ").toLowerCase().includes(k)
  ));
});

/* PDF LANDSCAPE */
async function exportPDF(){
  const {jsPDF}=window.jspdf;
  const canvas=await html2canvas(document.body);
  const img=canvas.toDataURL("image/png");
  const pdf=new jsPDF("landscape","mm","a4");
  const w=pdf.internal.pageSize.getWidth();
  const h=canvas.height*w/canvas.width;
  pdf.addImage(img,"PNG",0,10,w,h);
  pdf.save("Master_Barang_CV_Mestika_Lestari.pdf");
}

loadMaster();
</script>

</body>
</html>
