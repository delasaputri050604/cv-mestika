<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Invoice ‚Äî CV Mestika Lestari</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  margin:0;
}

header{
  background:#2e7d32;
  color:white;
  padding:20px;
  text-align:center;
}

.container{
  width:95%;
  max-width:1300px;
  margin:auto;
}

.card{
  background:white;
  margin-top:20px;
  padding:20px;
  border-radius:8px;
  box-shadow:0 2px 10px rgba(0,0,0,.1);
}

button{
  padding:10px 16px;
  background:#2e7d32;
  color:white;
  border:none;
  border-radius:6px;
  cursor:pointer;
  margin-right:6px;
}

input{
  padding:10px;
  width:250px;
  margin-bottom:10px;
}

/* TABLE */
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
  font-size:13px;
}

th,td{
  border:1px solid #000;
  padding:8px;
}

th{
  background:#e8f5e9;
}

/* ZEBRA ROW */
tbody tr:nth-child(odd){
  background:#f9f9f9;
}

tbody tr:nth-child(even){
  background:#ffffff;
}

tbody tr:hover{
  background:#e0f2f1;
}

/* PRINT */
@media print{
  @page{ size: A4 landscape; }
  header,.no-print{ display:none!important; }
  body{ background:white; }
  .card{ box-shadow:none; border:none; }
}
</style>
</head>

<body>

<header>
  <h1>INVOICE</h1>
  <p>CV Mestika Lestari</p>
</header>

<div class="container">

  <div class="card no-print">
    <input id="search" placeholder="üîç Cari invoice...">
    <br>
    <button onclick="window.print()">üñ®Ô∏è Print</button>
    <button onclick="exportPDF()">üìÑ Export PDF</button>
  </div>

  <div class="card">
    <table>
      <thead id="thead"></thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzE-YZQKET-UeZd43r194MEnEyysUQvohtQRx18Iee389UCCuxrQSO7FQi_iTeE7-uk/exec";
let allData = [];

/* ===== UTIL ===== */
function formatTanggal(val){
  if(!val) return "";
  return new Date(val).toLocaleDateString("id-ID");
}

function formatRupiah(val){
  if(val === "" || val === null || val === undefined || isNaN(val)){
    return "";
  }
  return "Rp " + Number(val).toLocaleString("id-ID");
}

/* ===== RENDER TABLE ===== */
function renderTable(data){
  if(!data.length) return;

  thead.innerHTML =
    "<tr>" +
    Object.keys(data[0]).map(h=>`<th>${h}</th>`).join("") +
    "</tr>";

  tbody.innerHTML = "";

  data.forEach(row=>{
    tbody.innerHTML +=
      "<tr>" +
      Object.entries(row).map(([key,val])=>{

        if(key.includes("TGL")){
          return `<td>${formatTanggal(val)}</td>`;
        }

        if(
          key.includes("HARGA") ||
          key.includes("PPN") ||
          key.includes("TOTAL")
        ){
          return `<td style="text-align:right">${formatRupiah(val)}</td>`;
        }

        if(key.includes("BANYAK") || key.includes("QTY")){
          return `<td style="text-align:center">${val ?? ""}</td>`;
        }

        return `<td>${val ?? ""}</td>`;
      }).join("") +
      "</tr>";
  });
}

/* ===== LOAD DATA ===== */
async function loadData(){
  const res = await fetch(API_URL);
  allData = await res.json();
  renderTable(allData);
}

/* ===== SEARCH ===== */
search.addEventListener("input",()=>{
  const q = search.value.toLowerCase();
  const filtered = allData.filter(r =>
    Object.values(r).some(v => String(v).toLowerCase().includes(q))
  );
  renderTable(filtered);
});

/* ===== PDF ===== */
function exportPDF(){
  const element = document.querySelector(".card:last-child");
  html2pdf().set({
    margin:5,
    filename:'Invoice-CV-Mestika-Lestari.pdf',
    html2canvas:{ scale:2 },
    jsPDF:{ unit:'mm', format:'a4', orientation:'landscape' }
  }).from(element).save();
}

loadData();
</script>

</body>
</html>
